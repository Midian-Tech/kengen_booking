{% extends 'base.html' %}

{% block content %}
<h2 class="my-4">My Bookings</h2>
<form method="get" class="mb-3">
  <div class="input-group">
    <input type="number" name="booking_id" class="form-control" placeholder="Search by Booking ID" value="{{ request.args.get('booking_id', '') }}">
    <button type="submit" class="btn btn-primary">Search</button>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-bordered table-hover table-striped">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Room</th>
        <th>Equipment</th>
        <th>Status</th>
        <th>Returned</th>
        <th>Details</th>
        <th>Ticket</th>
      </tr>
    </thead>
    <tbody>
      {% for booking in bookings %}
      <tr>
        <td>{{ booking.id }}</td>
        <td>{{ booking.room.name if booking.room else '—' }}</td>
        <td>{{ booking.equipment.name if booking.equipment else '—' }}</td>
        <td>
          <span class="badge 
            {% if booking.status == 'Approved' %}bg-success
            {% elif booking.status == 'Rejected' %}bg-danger
            {% else %}bg-warning text-dark{% endif %}">
            {{ booking.status }}
          </span>
        </td>
        <td>
          {% if booking.returned %}
            <span class="text-success">Yes</span>
          {% else %}
            <span class="text-danger">No</span>
          {% endif %}
        </td>
        <td>
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#detailsModal{{ booking.id }}">
            Details
          </button>
        </td>
        <td>
          {% if booking.status == 'Approved' %}
            <a href="{{ url_for('booking.generate_ticket', booking_id=booking.id) }}" class="btn btn-sm btn-outline-success">
              Download
            </a>
          {% else %}
            —
          {% endif %}
        </td>
      </tr>

      <!-- Modal for each booking -->
      <div class="modal fade" id="detailsModal{{ booking.id }}" tabindex="-1" aria-labelledby="detailsModalLabel{{ booking.id }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="detailsModalLabel{{ booking.id }}">Booking Details - #{{ booking.id }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p><strong>Room:</strong> {{ booking.room.name if booking.room else '—' }}</p>
              <p><strong>Equipment:</strong> {{ booking.equipment.name if booking.equipment else '—' }}</p>
              <p><strong>Status:</strong> {{ booking.status }}</p>
              <p><strong>Returned:</strong> {{ 'Yes' if booking.returned else 'No' }}</p>
              <p><strong>Start Time:</strong> {{ booking.start_time.strftime('%Y-%m-%d %H:%M') }}</p>
              <p><strong>End Time:</strong> {{ booking.end_time.strftime('%Y-%m-%d %H:%M') }}</p>
              <p><strong>Created At:</strong> {{ booking.created_at.strftime('%Y-%m-%d %H:%M') if booking.created_at else 'N/A' }}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
